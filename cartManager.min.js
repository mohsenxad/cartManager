!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clsGood=void 0;var o=function(t,e,n,o){this.id=t,this.title=e,this.price=n,this.imageUrl=o};e.clsGood=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clsCartItem=void 0;var o=function(t,e){this.good=t,this.count=e};e.clsCartItem=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(3);var o,r,i=n(4);r=function(){o=new i.CartManager(document),window.CartManager=o},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(r,1):document.addEventListener("DOMContentLoaded",r)},function(t,e,n){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CartManager=void 0;var o=n(0),r=n(5),i=n(6),a=n(8),c=n(10),s=n(15),u=n(16),d=n(17),l=n(19),p=function(){function t(t){var e=this;this.document=t,this.cartPlaceHolder=this.getCartPlaceHolder(),this.cartPlaceHolder.setAttribute("class","e__cartManager"),this.cartBannerComponent=new a.CartBannerComponent(this.document),this.cartBannerComponent.banner.addEventListener("click",(function(){e.onBannerClicked()})),this.cartPanelComponent=new c.CartPanelComponent(this.document,this.onRemoveCartItemButtonClick.bind(this),this.onClearCartClicked.bind(this)),this.cartPanelComponent.checkoutButton.addEventListener("click",(function(){e.onCheckOutClicked()})),this.checkoutPanelComponent=new s.CheckoutPanelComponent(this.document),this.checkoutPanelComponent.submitButton.addEventListener("click",(function(){e.onOrderSubmitClicked()})),this.receiptComponent=new l.ReceiptComponent(this.document),this.insertAddToCartButtonToHTML(),this.cartPlaceHolder.appendChild(this.cartBannerComponent.banner),this.cartPlaceHolder.appendChild(this.cartPanelComponent.cartPanel),this.cartPlaceHolder.appendChild(this.checkoutPanelComponent.checkoutPanel),this.cartPlaceHolder.appendChild(this.receiptComponent.receiptPanel),this.fetchFromLocalStorage()}return t.prototype.fetchFromLocalStorage=function(){this.cartBannerComponent.updateCounter(this.cart.cartItemList.length),this.cartPanelComponent.update(this.cart.cartItemList)},t.prototype.getCartPlaceHolder=function(){var t=this.document.querySelector("cartPanel");if(t){var e=t.getAttribute("shop_api_store_id");if(e)return this.cart=new i.clsCart(e),console.log("init cartManager for storID :"+e),this.cart.updateCartFromLocalStorage(),t;console.log('لطفا برای تگ <cartPanel shop_api_store_id="<shopApiStoreId>"></cartPanle> مقدار shop_api_store_id را ثبت کنید')}else console.log('لطفا در جای مناسب تگ <cartPanel shop_api_store_id="<shopApiStoreId>"></cartPanel> را اضافه کنید.')},t.prototype.onBannerClicked=function(){this.cart.togglePanel(),console.log("banner clicked"),this.cartPanelComponent.toggleVisibility(),this.checkoutPanelComponent.hide(),this.receiptComponent.hide()},t.prototype.onCheckOutClicked=function(){console.log("checkout clicked"),this.cartPanelComponent.toggleVisibility(),this.checkoutPanelComponent.show()},t.prototype.onSubmitOrderSuceess=function(t){console.log(t),this.receiptComponent.show(),this.checkoutPanelComponent.hide()},t.prototype.onOrderSubmitClicked=function(){var t=this;this.cart.userTitle=this.checkoutPanelComponent.getUserTitle(),this.cart.mobileNumber=this.checkoutPanelComponent.getMobileNumber(),this.cart.shippingAddress=this.checkoutPanelComponent.getShippingAddress();var e=(new u.OrderValidator).isValid(this.cart);e.isValid?(new d.OrderService).submitOrder(this.cart).then((function(e){t.onSubmitOrderSuceess(e)})).catch((function(t){console.log(t)})):console.log(e.messageList)},t.prototype.insertAddToCartButtonToHTML=function(){var t=this;this.document.querySelectorAll("shopApigoodListItem").forEach((function(e){var n=new o.clsGood(e.getAttribute("id"),e.getAttribute("title"),parseInt(e.getAttribute("price")),e.getAttribute("imageUrl"));t.insertAddToCartButtonToElement(e,n)}))},t.prototype.insertAddToCartButtonToElement=function(t,e){var n=this,o=new r.AddToCartButtonComponent(document,e).addToCartButton;o.addEventListener("click",(function(){n.addToCartButtonClicked(e)})),t.appendChild(o)},t.prototype.addToCartButtonClicked=function(t){this.cart.addToCart(t),this.cartBannerComponent.updateCounter(this.cart.cartItemList.length),this.cartPanelComponent.update(this.cart.cartItemList)},t.prototype.onRemoveCartItemButtonClick=function(t){this.cart.removeFromCart(t),this.cartBannerComponent.updateCounter(this.cart.cartItemList.length),this.cartPanelComponent.update(this.cart.cartItemList)},t.prototype.onClearCartClicked=function(){this.cart.clearCart(),this.cartBannerComponent.updateCounter(this.cart.cartItemList.length),this.cartPanelComponent.update(this.cart.cartItemList)},t.prototype.hi=function(){console.log("Hi store"),console.log(this)},t}();e.CartManager=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AddToCartButtonComponent=void 0;var o=function(){function t(t,e){this.document=t,this.addToCartButton=this.create(e)}return t.prototype.create=function(t){var e=document.createElement("button");return e.innerHTML="افزودن به سبد خرید",e},t}();e.AddToCartButtonComponent=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clsCart=void 0;var o=n(1),r=n(7),i=function(){function t(t){this.cartItemList=[],this.totalPrice=0,this.isPanelVisible=!1,this.storeId=t,this.cartLocalStorageManager=new r.CartLocalStorageManager(t)}return t.prototype.updateCartFromLocalStorage=function(){this.cartItemList=this.cartLocalStorageManager.getCart()},t.prototype.addToCart=function(t){if(!this.cartItemList.find((function(e){if(t.id==e.good.id)return e}))){var e=new o.clsCartItem(t,1);this.cartItemList.push(e),this.cartLocalStorageManager.updateCart(this.cartItemList)}},t.prototype.removeFromCart=function(t){var e=this.cartItemList.filter((function(e){if(t.good.id!=e.good.id)return t}));this.cartItemList=e,this.cartLocalStorageManager.updateCart(this.cartItemList)},t.prototype.clearCart=function(){this.cartItemList=[],this.cartLocalStorageManager.updateCart(this.cartItemList)},t.prototype.togglePanel=function(){this.isPanelVisible=!this.isPanelVisible},t}();e.clsCart=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CartLocalStorageManager=void 0;var o=n(1),r=n(0),i=function(){function t(t){this.storeId=t,this.cartStorageKey=t+"_cart"}return t.prototype.updateCart=function(t){console.log(t),localStorage.setItem(this.cartStorageKey,JSON.stringify(t))},t.prototype.getCart=function(){var t=[],e=JSON.parse(localStorage.getItem(this.cartStorageKey));return e&&e.forEach((function(e){t.push(new o.clsCartItem(new r.clsGood(e.good.id,e.good.title,e.good.price,e.good.imageUrl),e.count))})),console.log(t),t},t}();e.CartLocalStorageManager=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CartBannerComponent=void 0;var o=n(9),r=function(){function t(t){this.document=t,this.counterComponent=new o.cartBannerCounterComponent(this.document).create(),this.banner=this.create()}return t.prototype.create=function(){var t=document.createElement("div"),e=document.createElement("span");return e.setAttribute("class","e__banner_img"),t.appendChild(e),e.innerText="سبد خرید",t.id="e__banner__",t.appendChild(this.counterComponent),t},t.prototype.updateCounter=function(t){this.counterComponent.innerText=t.toString()+" محصول "},t}();e.CartBannerComponent=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cartBannerCounterComponent=void 0;var o=function(){function t(t){this.docuemnt=document}return t.prototype.create=function(){var t=document.createElement("span");return t.id="e__banner__counter",t},t}();e.cartBannerCounterComponent=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CartPanelComponent=void 0;var o=n(11),r=n(14),i=function(){function t(t,e,n){this.document=t,this.onRemoveFromCartClickedMethod=e,this.onClearCartClicked=n,this.cartListComponent=new o.CartListComponent(this.document,this.onRemoveFromCartClickedMethod),this.totalPriceComponent=new r.TotalPriceComponent(this.document),this.cartPanel=this.create(),this.isVisible=!1}return t.prototype.onRemoveFromCartClickedMethodInner=function(t){console.log("removed"),console.log(t),console.log(this)},t.prototype.create=function(){var t=this,e=document.createElement("div");e.id="e__cartPanel",e.setAttribute("class","e__cartPanel_deactive");var n=document.createElement("h3");n.innerText="سبد خرید شما";var o=document.createElement("div");o.setAttribute("class","e__cartPanel_img"),o.addEventListener("click",(function(){console.log("remove all items"),t.onClearCartClicked()}),!1);var r=document.createElement("h4");return r.innerText="مجموع سفارش شما:",this.checkoutButton=document.createElement("button"),this.checkoutButton.innerText="تسویه حساب",e.appendChild(n),e.appendChild(o),e.appendChild(this.cartListComponent.listWebComponent),e.appendChild(r),e.appendChild(this.totalPriceComponent.totalPriceComponent),e.appendChild(this.checkoutButton),e},t.prototype.update=function(t){this.cartListComponent.update(t),this.totalPriceComponent.update(this.calculateTotalPrice(t))},t.prototype.calculateTotalPrice=function(t){return t.reduce((function(t,e){return t+e.good.price}),0)},t.prototype.show=function(){this.isVisible=!0,this.cartPanel.setAttribute("class","e__cartPanel_active")},t.prototype.hide=function(){this.isVisible=!1,this.cartPanel.setAttribute("class","e__cartPanel_deactive")},t.prototype.toggleVisibility=function(){1==this.isVisible?this.hide():this.show()},t}();e.CartPanelComponent=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CartListComponent=void 0;var o=n(12),r=function(){function t(t,e){this.document=t,this.listWebComponent=this.create(),this.onRemoveFromCartClickedMethod=e}return t.prototype.create=function(){var t=document.createElement("ol");return t.id="e__cartPanel__cartList",t},t.prototype.update=function(t){for(var e=this;this.listWebComponent.firstChild;)this.listWebComponent.removeChild(this.listWebComponent.firstChild);t.forEach((function(t){var n=new o.CartListItemComponent(document,t,e.onRemoveFromCartClickedMethod).cartListItem;e.listWebComponent.appendChild(n)}))},t}();e.CartListComponent=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CartListItemComponent=void 0;var o=n(13),r=function(){function t(t,e,n){this.document=t,this.onRemoveFromCartClickedMethod=n,this.cartListItem=this.create(e)}return t.prototype.create=function(t){var e=this,n=this.document.createElement("li");n.id="e__cartPanel__cartList__cartItemList__"+t.good.id.toString(),this.removeFromCartButton=new o.removeListItemButtonComponent(this.document).removeFromCartButton,this.removeFromCartButton.addEventListener("click",(function(){e.onRemoveFromCartClickedMethod(t)}),!1);var r=this.document.createElement("img");r.setAttribute("class","e__cartPanel__cartList__cartItemList__dd_img");var i=this.document.createElement("span"),a=this.document.createElement("span"),c=this.document.createElement("span");r.src=t.good.imageUrl,a.innerText=t.good.title,i.innerText=t.count.toString(),c.innerText=t.good.price.toString();var s=this.document.createElement("dl");s.setAttribute("class","e__cartPanel__cartList__cartItemList__dd");var u=this.document.createElement("dt");u.innerText="حذف";var d=this.document.createElement("dd");d.appendChild(this.removeFromCartButton),s.appendChild(u),s.appendChild(d);var l=this.document.createElement("dt");l.innerText="عکس";var p=this.document.createElement("dd");p.appendChild(r),s.appendChild(l),s.appendChild(p);var h=this.document.createElement("dt");h.innerText="عنوان";var m=this.document.createElement("dd");m.innerText=t.good.title,s.appendChild(h),s.appendChild(m);var C=this.document.createElement("dt");C.innerText="تعداد";var f=this.document.createElement("dd");f.innerText=t.count.toString(),s.appendChild(C),s.appendChild(f);var v=this.document.createElement("dt");v.innerText="قیمت";var g=this.document.createElement("dd");return g.innerText=t.good.price.toString(),s.appendChild(v),s.appendChild(g),n.appendChild(s),n},t}();e.CartListItemComponent=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeListItemButtonComponent=void 0;var o=function(){function t(t){this.document=t,this.removeFromCartButton=this.create()}return t.prototype.create=function(){var t=this.document.createElement("button");return t.innerText="حذف",t},t}();e.removeListItemButtonComponent=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TotalPriceComponent=void 0;var o=function(){function t(t){this.document=t,this.totalPriceComponent=this.create()}return t.prototype.create=function(){var t=this.document.createElement("label");return t.id="e__cartPanel__totalPriceValue",t},t.prototype.update=function(t){this.totalPriceComponent.innerText=t.toString()},t}();e.TotalPriceComponent=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CheckoutPanelComponent=void 0;var o=function(){function t(t){this.document=t,this.checkoutPanel=this.create()}return t.prototype.create=function(){var t=document.createElement("div");t.id="e__checkoutPanel",t.setAttribute("class","e__checkoutPanel_deactive");document.createElement("div");var e=document.createElement("button");e.innerText="×";var n=document.createElement("h3");n.innerText="نهایی کردن سفارش";var o=document.createElement("label");o.innerText="نام و نام خانوادگی",this.userTitleInput=this.document.createElement("input"),this.userTitleInput.type="text";var r=document.createElement("label");r.innerText="شماره موبایل",this.userMobileNumberInput=this.document.createElement("input"),this.userMobileNumberInput.type="text",this.userMobileNumberInput.maxLength=11;var i=document.createElement("label");return i.innerText="آدرس",this.shippingAddressInput=this.document.createElement("textarea"),this.submitButton=document.createElement("button"),this.submitButton.innerText="ثبت",t.appendChild(e),t.appendChild(n),t.appendChild(o),t.appendChild(this.userTitleInput),t.appendChild(r),t.appendChild(this.userMobileNumberInput),t.appendChild(i),t.appendChild(this.shippingAddressInput),t.appendChild(this.submitButton),t},t.prototype.getUserTitle=function(){return this.userTitleInput.value},t.prototype.getMobileNumber=function(){return this.userMobileNumberInput.value},t.prototype.getShippingAddress=function(){return this.shippingAddressInput.value},t.prototype.show=function(){this.checkoutPanel.setAttribute("class","e__checkoutPanel_active")},t.prototype.hide=function(){this.checkoutPanel.setAttribute("class","e__checkoutPanel_deactive")},t}();e.CheckoutPanelComponent=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OrderValidator=void 0;var o=function(){function t(){}return t.prototype.isValid=function(t){var e={isValid:!0,messageList:[]};return 0==t.cartItemList.length&&(e.isValid=!1,e.messageList.push("سبد خرید شما خالی میباشد.ابتدا سفارش خود را کامل کنید.")),t.userTitle||(e.isValid=!1,e.messageList.push("نام و نام خانوادگی خود را وارد کنید.")),t.userTitle&&t.userTitle.length<3&&(e.isValid=!1,e.messageList.push("نام و نام خانوادگی خود را به صورت کامل وارد کنید.")),t.mobileNumber||(e.isValid=!1,e.messageList.push("شماره موبایل خود را وارد کنید.")),t.mobileNumber&&11!=t.mobileNumber.length&&(e.isValid=!1,e.messageList.push("شماره موبایل میبایست 11 رقم باشد")),t.mobileNumber&&11==t.mobileNumber.length&&!t.mobileNumber.startsWith("09")&&(e.isValid=!1,e.messageList.push("شماره موبایل میبایست با 09 شروع شود.")),t.shippingAddress||(e.isValid=!1,e.messageList.push("آدرس دریافت سفارش را وارد کنید")),t.shippingAddress&&t.shippingAddress.length<10&&(e.isValid=!1,e.messageList.push("آدرس دریافت سفارش را همراه بااسم استان و شهر و جزئییات وارد کنید.")),e},t}();e.OrderValidator=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OrderService=void 0;var o=n(18),r=function(){function t(){}return t.prototype.submitOrder=function(t){var e=this;console.log(t);var n={storeId:t.storeId,mobileNumber:t.mobileNumber,address:t.shippingAddress,orderItemList:t.cartItemList};return new Promise((function(t,r){e.postData("http://api_window_store.befrooshim.com/order/create",n).then((function(e){console.log(e),t(new o.clsOrder("1"))})).catch((function(t){r(t)}))}))},t.prototype.postData=function(t,e){var n=new XMLHttpRequest;return new Promise((function(o,r){n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){4===n.readyState&&(200==n.status?o(n):r({status:n.status,statusText:n.statusText}))},n.send(JSON.stringify(e))}))},t}();e.OrderService=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clsOrder=void 0;var o=function(t){this.id=t};e.clsOrder=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ReceiptComponent=void 0;var o=function(){function t(t){this.document=t,this.receiptPanel=this.create()}return t.prototype.create=function(){var t=document.createElement("div");t.id="e__receipt",t.setAttribute("class","e__receipt_deactive"),document.createElement("button").innerText="×";var e=document.createElement("div");e.setAttribute("class","e__receipt_img");var n=document.createElement("h3");n.innerText="سفارش شما با موفقیت ثبت شد";var o=document.createElement("p");o.innerText="از سفارش شما متشکریم. برای هماهنگی زمان ارسال با شما تماس خواهیم گرفت";var r=document.createElement("button");return r.innerText="باشه",t.appendChild(e),t.appendChild(n),t.appendChild(o),t.appendChild(r),t},t.prototype.show=function(){this.receiptPanel.setAttribute("class","e__receipt_active")},t.prototype.hide=function(){this.receiptPanel.setAttribute("class","e__receipt_deactive")},t}();e.ReceiptComponent=o}]);